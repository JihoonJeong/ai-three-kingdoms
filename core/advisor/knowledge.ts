// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// AI 삼국지 — 적벽대전 배경지식 (Knowledge Chunks)
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
//
// 지식은 게임 상황에 따라 최대 3개까지 선택되어
// 제갈량의 system prompt에 주입된다.

export interface KnowledgeChunk {
  id: string;
  title: string;
  content: string;
  /** 이 지식이 관련되는 게임 상태 조건 */
  relevance: {
    phases?: ('preparation' | 'battle' | 'aftermath')[];
    /** 특정 flag가 true일 때 */
    flags?: string[];
    /** 특정 턴 범위 */
    turnRange?: { min: number; max: number };
    /** 항상 포함할지 여부 */
    always?: boolean;
  };
}

export const KNOWLEDGE_CHUNKS: KnowledgeChunk[] = [
  {
    id: 'sun_diplomacy',
    title: '손권 외교 전략',
    content: `손권은 강동의 패자로, 아버지 손견·형 손책에 이어 오(吳)를 다스린다.
조조의 남하에 위기감을 느끼지만, 항복파(장소)와 항전파(주유·노숙)로 나뉘어 결단을 내리지 못하고 있다.
유비-손권 동맹의 핵심은 "조조를 막지 않으면 둘 다 망한다"는 공동 위기의식이다.
외교 시 손권의 자존심을 살려주고, 동맹의 실익을 구체적으로 제시하는 것이 효과적이다.
노숙은 동맹 유지의 핵심 인물이므로 관계를 잘 유지해야 한다.`,
    relevance: {
      phases: ['preparation'],
    },
  },
  {
    id: 'fire_tactic',
    title: '화공(火攻) 전술',
    content: `적벽의 핵심 전술은 화공이다. 조조 수군은 배를 연환(連環)으로 묶어 놓았으므로,
불이 붙으면 전 함대로 번진다. 성공 조건:
1) 동남풍이 불어야 함 (겨울에 동남풍은 이례적)
2) 적의 연환진을 유지시켜야 함 (간첩 봉통의 역할)
3) 화선(火船)을 준비해야 함 (황개의 거짓 항복)
화공은 병력 열세를 뒤집을 수 있는 유일한 전략이지만, 하나라도 빠지면 실패한다.`,
    relevance: {
      phases: ['preparation', 'battle'],
    },
  },
  {
    id: 'southeast_wind',
    title: '동남풍과 시기',
    content: `겨울(동지 전후)에 동남풍이 부는 것은 매우 드문 기상 현상이다.
역사적으로 제갈량은 이 바람을 예측(혹은 기도)하여 화공의 결정적 조건을 만들었다.
게임에서 동남풍은 특정 턴 이벤트로 발생하며, 이때가 화공의 최적 타이밍이다.
동남풍이 불기 전에 모든 준비(연환 유지, 화선 준비, 내응자 확보)를 마쳐야 한다.
바람은 영원히 불지 않으므로, 기회가 오면 즉시 실행해야 한다.`,
    relevance: {
      phases: ['preparation', 'battle'],
      flags: ['southeastWindHint'],
    },
  },
  {
    id: 'cao_navy_weakness',
    title: '조조 수군의 약점',
    content: `조조의 핵심 전력은 80만(실제 20-25만) 대군이지만, 대부분 북방 보병이다.
수전(水戰) 경험이 없어 병사들이 선멀미에 시달리고, 이를 해결하려 배를 연환으로 묶었다.
이는 안정성은 높이지만 기동성을 포기한 것이며, 화공에 치명적 취약점이 된다.
또한 형주 항복군을 대거 편입하여 충성도가 낮고, 내부 와해 가능성이 있다.
채모·장윤 같은 수군 장수가 제거되면 조조 수군의 전투력은 급락한다.`,
    relevance: {
      phases: ['preparation', 'battle'],
    },
  },
  {
    id: 'jingzhou_situation',
    title: '형주 정세',
    content: `형주는 천하의 요충지로, 북으로 조조, 동으로 손권, 서로 익주(유장)에 접한다.
유표 사후 차남 유종이 조조에게 항복하여 형주 대부분이 조조 수중에 들어갔다.
유비는 하구·강하 일대를 거점으로 유지하고 있으나 영토와 병력이 부족하다.
적벽 승리 후 형주의 분배가 유비-손권 동맹의 최대 갈등 요인이 될 것이다.
장기적으로 형주를 확보해야 "천하삼분지계"의 기반이 마련된다.`,
    relevance: {
      phases: ['preparation', 'aftermath'],
    },
  },
  {
    id: 'retreat_strategy',
    title: '후퇴와 추격 전략',
    content: `전투에서 절대적으로 불리할 때는 전략적 후퇴가 최선이다.
"삼십육계 주위상(走爲上)" — 도망이 최상의 계책이라는 뜻.
전력을 보존하여 다음 기회를 노리는 것이 무모한 돌격보다 낫다.
반대로 적이 패주할 때는 화용도(華容道) 같은 요충지에서 매복하여 추격하면,
적의 잔여 전력을 소멸시키고 장수를 포획할 수 있다.
다만 추격 시 적의 반격에 주의해야 한다.`,
    relevance: {
      phases: ['battle', 'aftermath'],
    },
  },
  {
    id: 'alliance_maintenance',
    title: '동맹 유지의 기술',
    content: `동맹은 공동의 적이 있을 때 가장 견고하다. 조조가 건재한 동안은 동맹이 유지되지만,
조조가 약해지면 동맹 내부 균열이 시작된다.
동맹을 유지하려면: 전과(戰果)를 공정하게 분배하고,
상대의 공을 인정하며, 독단적 행동을 피해야 한다.
손권에게는 실리를, 주유에게는 명분을 주는 것이 효과적이다.
동맹이 깨지면 양면 전쟁에 빠져 유비군은 존망의 위기에 처한다.`,
    relevance: {
      phases: ['preparation', 'battle', 'aftermath'],
    },
  },
  {
    id: 'naval_warfare',
    title: '수전(水戰) 원칙',
    content: `적벽은 양자강 수상전이다. 수전의 핵심 원칙:
1) 풍향 — 바람을 등지고 싸우면 유리, 화공은 풍향이 절대적
2) 진형 — 학익진(鶴翼陣)은 포위에, 장사진(長蛇陣)은 돌파에 유리
3) 화공 — 수전 최강의 전술, 단 역풍이면 자멸
4) 기동성 — 소형 쾌선이 대형 전함보다 기습에 유리
5) 사기 — 수전은 공포감이 크므로 사기 관리가 핵심
유비군은 소수 정예이므로 정면 교전을 피하고 기략으로 승부해야 한다.`,
    relevance: {
      phases: ['battle'],
    },
  },
  {
    id: 'nanjun_capture',
    title: '남군 공략 전략',
    content: `적벽 대승 후 최우선 목표는 남군(남군) 점령이다. 남군은 형주의 핵심 거점으로,
이를 확보해야 형주 전역을 장악할 수 있다.
조조 패잔병의 사기가 바닥이므로, 지체 없이 진군하는 것이 상책이다.
조인(曹仁)은 용맹하지만 수비 병력이 크게 줄었으니, 병력을 집중하면 승산이 있다.
공성전 요령: 1) 식량을 충분히 확보한 후 진군 2) 정찰로 적 병력 파악
3) 장수를 집중 배치하여 전투력 극대화 4) 매복이나 위장퇴각으로 유인 후 공격.`,
    relevance: {
      phases: ['aftermath'],
      flags: ['chibiVictory'],
    },
  },
  {
    id: 'post_chibi_governance',
    title: '적벽 이후 형주 경략',
    content: `적벽 승리는 시작에 불과하다. 형주를 실질적으로 지배하려면:
1) 남군 점령 — 조인의 잔병을 격파하고 형주 중심부 확보
2) 형주 4군 귀순 — 적벽 대승의 위세로 장사·무릉·영릉·계양 태수들을 귀순시킬 수 있다
3) 민심 안정 — 점령 후 약탈을 금하고, 선정을 베풀어 민심을 얻어야 한다
4) 손권과의 영토 분쟁 관리 — 형주는 손권도 노리므로, 동맹을 유지하면서 기정사실화해야 한다
지금은 군사 행동에 집중하되, 외교를 소홀히 하면 안 된다.`,
    relevance: {
      phases: ['aftermath'],
      flags: ['chibiVictory'],
    },
  },
];
